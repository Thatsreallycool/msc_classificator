import matplotlib.pyplot as plt
import numpy as np

results = {7: {'precisions': [0.5028962818003914, 0.4389889106327462, 0.38202217873450756, 0.3343157208088715, 0.29553555120678404, 0.2646288323548597, 0.2392786785947256, 0.2184029447395397, 0.20111875252384062], 'recalls': [0.4081365048302426, 0.5134051812505825, 0.5793337526791539, 0.6227521821513995, 0.6520845991364581, 0.6753342030876277, 0.6914915509582827, 0.7042232628211103, 0.7157657565309228], 'entities': 3261680}, 6: {'precisions': [0.502290165988099, 0.4384982774819919, 0.3816421338344295, 0.334006681281971, 0.2952826495458816, 0.26443205374852724, 0.2391088019924537, 0.2182450201084714, 0.20097025238741495], 'recalls': [0.40769827909762923, 0.5129701504779801, 0.5789168642715464, 0.6223983422317669, 0.651763095362375, 0.6750775350593311, 0.6912660818059346, 0.7040086138328387, 0.7155616483726802], 'entities': 3211453}, 5: {'precisions': [0.5009011479841712, 0.43725267405869217, 0.38075134845694736, 0.33330786610769375, 0.2947047760843161, 0.26392768054210675, 0.23866265347968124, 0.21785081492012495, 0.20058577728522484], 'recalls': [0.406779956951371, 0.5117831162555528, 0.5778695406384158, 0.6213881006176192, 0.6508756185675042, 0.6742190361758986, 0.6905491716466131, 0.7033883848306134, 0.7149182747711524], 'entities': 3101755}, 4: {'precisions': [0.49342699054271477, 0.4315360567175503, 0.3762017815798767, 0.32981987991994666, 0.29192010359847737, 0.261577746508877, 0.23658839786748587, 0.21607581213494959, 0.19900212030553832], 'recalls': [0.400741234897339, 0.5054843284878994, 0.5716263223101116, 0.6156167759520975, 0.6454897413713094, 0.6690091558081984, 0.6854865272771328, 0.6986966879257817, 0.7104172934461754], 'entities': 2857525}, 3: {'precisions': [0.47597882343645054, 0.4174930530862734, 0.36520682707123386, 0.32098099640472527, 0.2849400129061146, 0.2558062464842125, 0.23174556140657834, 0.21203794635998027, 0.19557738244178927], 'recalls': [0.38743721752196325, 0.4906472529353886, 0.5566038481292718, 0.6008719779906221, 0.6316839312602024, 0.6556308882580069, 0.6726922637939586, 0.6867128477297969, 0.699235964913931], 'entities': 2355056}, 2: {'precisions': [0.4048760499897562, 0.358505770675408, 0.3156900908283821, 0.28066243256163353, 0.2520876869493956, 0.22789767904703362, 0.20854201422425145, 0.19250591051144217, 0.17891762031589936], 'recalls': [0.33185362419228426, 0.42498687817679826, 0.4855214583272358, 0.5299440005463361, 0.5631029941171305, 0.5865452206970339, 0.6071729218901928, 0.6242281376116656, 0.6397612055817342], 'entities': 1344040}}


keyword_lengths = list(results.keys())
entities = [results[item]["entities"] for item in keyword_lengths]
nr_plots = len(keyword_lengths)

fig, axs = plt.subplots(nr_plots, 2)
#fig.subplots_adjust(wspace=0.5, hspace=0)
fig.tight_layout()

p_base = results[keyword_lengths[0]]["precisions"]
r_base = results[keyword_lengths[0]]["recalls"]

p_min = 0
p_max = -1
r_min = 0
r_max = -1

for ax in range(nr_plots):
    p = results[keyword_lengths[ax]]["precisions"]
    r = results[keyword_lengths[ax]]["recalls"]
    axs[ax, 0].scatter(p,r, marker='.')
    p_diff = [x1-x2 for (x1,x2) in zip(p,p_base)]
    r_diff = [x1-x2 for (x1,x2) in zip(r,r_base)]
    axs[ax, 1].scatter(p_diff, r_diff, marker='.')
    p_min = min(p_min, min(p_diff))
    r_min = min(r_min, min(r_diff))
    p_max = max(p_max, max(p_diff))
    r_max = max(r_max, max(r_diff))

for i, ax in enumerate(axs.flat):
    j = int(np.floor(i/2))
    if i%2:
        ax.set_xlim(p_min, p_max)
        ax.set_ylim(r_min, r_max)
        #ax.set(ylabel=f'ent:{entities[j]}')
        ax.set_title(f'ent:{entities[j]}')
    else:
        ax.set_xlim(0, 1)
        ax.set_ylim(0, 1)
        ax.set(ylabel=f'len:{keyword_lengths[j]}')

plt.savefig('./pdiff.pdf', format="pdf", bbox_inches="tight")

plt.show()